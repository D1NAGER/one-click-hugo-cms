<footer class="bg-black ph3 pv4 white">

	<div class="mw7 center pt3">

		<div class="measure-narrow center mb4">

			<img src="/img/logo.svg" alt="Kaldi logo" class="db w4 center mb4 br0">
			<p class="f3 lh-title light-gray b tc mb2">{{ .Site.Data.footer.title }}</p>
			<p>{{ .Site.Data.footer.blurb }}</p>

			{{ partial "newsletter-form" . }}

		</div>

		<div class="flex-ns justify-between">

			<div>
				<h3 class="f4 b lh-title mb1 primary">Kaldi</h3>
				<ul class="mb3">
					<li><a href="/" class="link">Home</a></li>
					<li><a href="/products" class="link">Our products</a></li>
					<li><a href="/values" class="link">About</a></li>
					<li><a href="/post" class="link">Blog</a></li>
					<li><a href="/contact" class="link">Contact</a></li>
				</ul>
			</div>

			<div>
				<h3 class="f4 b lh-title mb1 primary">Find out more</h3>
				<ul class="mb3">
					<li><a href="/post/jamaica-blue/" class="link">Latest offers</a></li>
					<li><a href="/contact" class="link">Schedule an appointment</a></li>
				</ul>
			</div>

			<div>
				<h3 class="f4 b lh-title mb2 primary">Social media</h3>
				<ul class="mhn2">
					{{ partial "social-icon" (dict "link" "https://facebook.com" "svg" "icons-facebook" "alt" "Kaldi on Facebook") }}
					{{ partial "social-icon" (dict "link" "https://twitter.com" "svg" "icons-twitter" "alt" "Kaldi on Twitter") }}
					{{ partial "social-icon" (dict "link" "https://instagram.com" "svg" "icons-instagram" "alt" "Kaldi on Instagram") }}
					{{ partial "social-icon" (dict "link" "https://vimeo.com" "svg" "icons-vimeo" "alt" "Kaldi on Vimeo") }}
				</ul>
			</div>

		</div>
	</div>

	<script>
  window.dataLayer = window.dataLayer || [];

  (function () {
    // Переконайся, що в HTML форми мають ці id:
    // <form id="contactUs">...</form>
    // <form id="newsletter">...</form>
    const FORMS = [
      { form_id: "contactUs",  lead_type: "contact",    selector: "form#contactUs" },
      { form_id: "newsletter", lead_type: "newsletter", selector: "form#newsletter" }
    ];

    // Dedup: 1 раз на форму за page load
    const started = new Set();
    const viewed = new Set();

    function pushEvent(eventName, meta) {
      window.dataLayer.push({
        event: eventName,
        form_id: meta.form_id,
        lead_type: meta.lead_type
      });
    }

    function initFormStart(form, meta) {
      const fire = () => {
        if (started.has(meta.form_id)) return;
        started.add(meta.form_id);
        pushEvent("form_start", meta);
      };

      // form_start: перший фокус/ввід в межах форми
      form.addEventListener("focusin", fire, { passive: true });
      form.addEventListener("input", fire, { passive: true });
    }

    function initFormView(form, meta) {
      // form_view: коли форма видима >= 50% (можеш змінити threshold)
      const threshold = 0.5;

      if (!("IntersectionObserver" in window)) return; // fallback: просто не відстрелить form_view

      const obs = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting) return;

          // entry.intersectionRatio ~ частка видимості елемента у viewport
          if (entry.intersectionRatio >= threshold) {
            if (viewed.has(meta.form_id)) return;
            viewed.add(meta.form_id);
            pushEvent("form_view", meta);
            obs.unobserve(form); // 1 раз
          }
        });
      }, { threshold: [threshold] });

      obs.observe(form);
    }

    function init() {
      FORMS.forEach((meta) => {
        const form = document.querySelector(meta.selector);
        if (!form) return;

        initFormStart(form, meta);
        initFormView(form, meta);
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  })();
</script>

</footer>

